import {LatestReadings} from "../../../components/ui/sections/latest-readings";
import {TSTag} from "../../../components/tags/typescript";
import {HeroLearnCard} from "../../../components/ui/generics/hero-learn-card";

# Perfect Timer for the Web

<HeroLearnCard
    category="typescript"
    tag={<TSTag/>}
    image={<section className="flex align-center justify-center gap-3 h-full overflow-hidden">
        <div className="bg-violet-500 h-40 w-40 p-1 mt-20 text-white font-bold">
            <span className="text-lg">
                ⏰ Thick<br />
                <span className="text-violet-300">⌛ now?</span>
                <br />
                <br />
                <br />
                ... tik, tok
            </span>
        </div>
        <div className="flex flex-col">
            <div className="bg-fuchsia-600 h-10 w-20 p-1 mt-20 text-white font-bold animate-bounce">Tik</div>
            <div className="bg-fuchsia-600 h-10 w-20 p-1 mt-1 text-white font-bold">Tok</div>
        </div>
    </section>}
    author="Kacper Walczak"
    createdAt="10-08-2024"
    title="Perfect Timer for the Web"
    descriptionTextLines={[
        "Learn how to create perfect 10min, etc. timer for your apps in typescript.",
    ]}
    label={<></>}
/>

<em className="text-gray-500">Last edit: 18-08-2024, Kacper Walczak</em>

## Introduction

Why do we need Perfect Timer?

There is one answer -> `setTimeout(() => {...}, 1000)` can be activated after 1002ms or 1008ms on another computer instead of 1000ms ;)

That's why we need to check whether 1sec is completed or not by iterating few times and proper checking e.g. 4 times a sec.

## Timer code

I have used this code to ensure better time management for PsyApp(there were tests when players needed to press appropriate keys in realtime and exact 10min -> reason why I needed to check time).

### `startTimer` function

```typescript copy filename="lib/timer.ts"
type IntervalID = number;

interface TimerObj {
    resume(): void;
    pause(): void;
    step(): number;
}
 
const startTimer = (seconds: number, oncomplete?: () => void, container?: string): TimerObj  => {
    let startTime: number;
    let timer: IntervalID;
    let ms = seconds * 1000;
    const display = container ? document.getElementById(container) : null; // if we pass container = 'your_element_id' it will allow us to print: '0:02' there
 
    const timerObj: TimerObj = {
        resume() {
            startTime = new Date().getTime();
            // lower numbers are more accurate, but more CPU-expensive
            timer = setInterval(this.step, 250); // adjust this number to affect granularity
        },
        pause() {
            ms = this.step();
            clearInterval(timer);
        },
        step() {
            const now = Math.max(0, ms - (new Date().getTime() - startTime));
    
            if (display) {
                const m = Math.floor(now / 60000);
                let s = Math.floor(now / 1000) % 60 as number | string;
                s = ((s as number) < 10 ? '0' : '') + s;
                display.innerHTML = m + ':' + s;
            }
    
            if (now === 0) {
                clearInterval(timer);
                this.resume = () => { };
                if (oncomplete) { oncomplete(); }
            }
            return now;
        }
    };
 
    timerObj.resume(); // initial run
    return timerObj;
};
```

### Usage

```typescript copy filename="lib/timer.ts"
// when we want to listen when counting has ended
const tenSeconds = 10;
const timer = startTimer(tenSeconds, () => console.log('on:completed'));

// when we want to provide HTML element to paste in timer like '0:10'
const tenMinutes = 60 * 10;
const timerShownOnScreen = startTimer(tenMinutes, () => console.log('on:completed'), 'tag_element_id_here');

// you can even pause on specific scenarios, here simple delay just for showcase
setTimeout(() => timerShownOnScreen.pause(), 2000);

// after resuming we will start from place where you have paused
setTimeout(() => timerShownOnScreen.resume(), 4000);
```

### Output

```bash copy /step()/
# example output with console.log inside step() function...
0:02
0:02
0:02
0:01
0:01
0:01
0:01
0:00
0:00
0:00
0:00
0:00
on:completed
```

## Conclusion

This way we can properly manage time in Javascript.

<section className="rounded-2xl bg-lines flex mt-10 mb-20 h-20 w-full"></section>

<LatestReadings />
